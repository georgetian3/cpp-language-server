<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Editor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/WebCoder49/code-input@1.1/code-input.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/WebCoder49/code-input@1.1/code-input.min.css">



    <script>
      
    </script>







    <script>
      codeInput.registerTemplate("syntax-highlighted", codeInput.templates.custom(
        function handle_update(result_element) {
          //result_element.innerHTML = '<span style="color:red">' + result_element.innerHTML + '</span>';

          fetch('http://127.0.0.1:5000/process', {
            method: 'POST',
            body: result_element.innerText
          }).then(response => response.json())
          .then((data) => {
            console.log(data);
            result_element.innerHTML = data.formatting;
            let suggestions = document.getElementById('suggestions')
            suggestions.innerHTML = '';
            for (const suggestion of data.suggestions) {
              console.log(suggestion);
              let button = document.createElement('button');
              button.setAttribute('onclick', 'autocomplete(this.innerText);');
              button.innerText = suggestion;
              var li = document.createElement('li');
              li.appendChild(button);
              suggestions.appendChild(li);
            }
          });
        },
        true, /* Optional - Is the `pre` element styled as well as the `code` element? Changing this to false uses the code element as the scrollable one rather than the pre element */
        true, /* Optional - This is used for editing code - setting this to true overrides the Tab key and uses it for indentation */
        false /* Optional - Setting this to true passes the `<code-input>` element as a second argument to the highlight function to be used for getting data- attribute values and using the DOM for the code-input */,
        [] // Array of plugins (see below)
      ));
      function autocomplete(text) {
        let editor_parent = document.getElementById('editor');
        let editor_textarea = editor_parent.getElementsByTagName('textarea')[0];
        let editor_value = editor_parent.getElementsByTagName('pre')[0].getElementsByTagName('code')[0];
        console.log(editor_parent, editor_textarea, editor_value);
        editor_value.innerHTML += text;
        editor_parent.value += text;
        editor_textarea.dispatchEvent(new Event('input'));
      }
      /* document.addEventListener('keydown', function(key) {
        if (key.keyCode != 9) { // not a tab key
          return;
        }
        key.preventDefault();
        key.stopPropagation();
        console.log(key);
        autocomplete();
      }); */
    </script>

  </head>
  <body>
    <code-input id="editor" lang="HTML" placeholder="Type code here" value="test" template="syntax-highlighted" onload="on_load()"></code-input>
    Autocomplete suggestions:
    <ul id="suggestions">
      <li><button onclick="autocomplete(this.innerText);">test</button></li>
    </ul>
  </body>

  


</html>